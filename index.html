<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Improve the Utility of ERA5 Data at AmeriFlux Site Locations • ERA5Flux</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Improve the Utility of ERA5 Data at AmeriFlux Site Locations">
<meta name="description" content="Collection of tools useful for workflows involving ERA5 and AmeriFlux data. Includes functions for downloading ERA5 data based on AmeriFlux sites, formatting the downloaded data to match AmeriFlux standards, merging both datasets together to ensure consistent timestamps, and blending them to create a single gap-filled time series.">
<meta property="og:description" content="Collection of tools useful for workflows involving ERA5 and AmeriFlux data. Includes functions for downloading ERA5 data based on AmeriFlux sites, formatting the downloaded data to match AmeriFlux standards, merging both datasets together to ensure consistent timestamps, and blending them to create a single gap-filled time series.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ERA5Flux</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/ERA5Flux.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Malone-Disturbance-Ecology-Lab/ERA5Flux/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="era5flux">ERA5Flux<a class="anchor" aria-label="anchor" href="#era5flux"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The primary objective of this repo is to improve the utility of ERA5 data at flux site locations.</p>
<p>Scripts are organized into the following groups</p>
</div>
<div class="section level1">
<h1 id="id_1-create-dfsitemetadata-file-00_sitemetadata">1. create df.sitemetadata file 00_sitemetadata<a class="anchor" aria-label="anchor" href="#id_1-create-dfsitemetadata-file-00_sitemetadata"></a>
</h1>
<ul>
<li>df that contains site meta data (site code, lat, lon, start date, end data, variables needed)</li>
</ul>
</div>
<div class="section level1">
<h1 id="id_2-pre-download-for-files-_01">2. pre-Download for Files _01<a class="anchor" aria-label="anchor" href="#id_2-pre-download-for-files-_01"></a>
</h1>
<ul>
<li>day_padding (add 1 day to start and end dates for future time zone offset issues)</li>
<li>utc_offset (add UTC offset to df.sitemetadata)</li>
<li>get_land_proportion (pull land-sea_mask for one day)</li>
<li>01_ERA5_API (use ecmwfr package with df.sitemetadata)</li>
</ul>
</div>
<div class="section level1">
<h1 id="data-is-downloaded">
<strong><em>DATA is Downloaded</em></strong><a class="anchor" aria-label="anchor" href="#data-is-downloaded"></a>
</h1>
</div>
<div class="section level1">
<h1 id="id_3-data-processing-for-era5-_02">3. Data Processing for ERA5 _02<a class="anchor" aria-label="anchor" href="#id_3-data-processing-for-era5-_02"></a>
</h1>
<p>02_csv_conversion: Takes directory as an argument and reformats ERA4 .nc data into csv format with the following characteristics.</p>
<ul>
<li>Uses two functions to reformat netcdf data:
<ul>
<li>netcdf_df_formatter(nc_file_path)
<ul>
<li>Input: (character) file path to a folder containing the netcdf files of one site.</li>
<li>Output: (dataframe) of the characteristics:
<ul>
<li>Datetime stamp column named “time”.</li>
<li>UTC timezones convetered to local time.</li>
<li>Time column formatted as yyyyMMddHHmm</li>
<li>Variables names from ERA5 dataset maintained</li>
<li>ERA5 units converted to Ameriflux units:</li>
<li>Solar radiation (ssrd) from Jm-2 to Wm-2.</li>
<li>Air Temperature (t2m) from Kelvin to celsius.</li>
<li>Total precipitation (tp) from meters to millimeters.</li>
</ul>
</li>
</ul>
</li>
<li>netcdf_to_csv(site_folder)
<ul>
<li>Input: (character) file path to a folder containing the netcdf files of one site.</li>
<li>Output: .csv file of netcdf data within site_folder.
<ul>
<li>The .csv file is located within the site_folder and has the file name format: siteID_startYear_endYear_variableName.csv For example, US-Ho1_2001_2020_tp_t2m.csv</li>
<li>SiteID is deetermined from lat and lon coordinates in df.sitemetadata.</li>
<li>Each csv file starts from the first hour of a year (e.g., 2000-01-01 00:00) and ends with the last hour of a year (e.g., 2020-12-31 23:00).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level1">
<h1 id="id_4-flux-data-merging_03">4. Flux Data Merging_03<a class="anchor" aria-label="anchor" href="#id_4-flux-data-merging_03"></a>
</h1>
<ul>
<li>Two functions to merge and blend ERA5 and FLUX data
<ul>
<li>03_01_merge_ERA5_FLUX: do interpolation of ERA5 data to ensure ERA5 and FLUX datasets share the same timestamp.<br>
</li>
<li>03_02_blend_ERA5_FLUX: blend ERA5 and FLUX datasets according to blending rules.</li>
</ul>
</li>
<li>Input and output variables of the two functions
<ul>
<li>input variables (character): filename_FLUX, filename_ERA5</li>
<li>input variables (vector of character): varname_FLUX, varname_ERA5</li>
<li>input variables (vector of character): blending_rules</li>
<li>output variables: a dataframe with the original ERA5 and FLUX data and gap-filled data for each varname</li>
</ul>
</li>
<li>Requirement of these input variables
<ul>
<li>varname_FLUX and varname_ERA5 should have the same length. These names of the same row should be matched.</li>
<li>blending_rules should have the same length with varname_FLUX and varname_ERA5. users should give rules for each variable.</li>
<li>options for blending_rules: “replace”, “lm”, “lm_no_intercept”, “automatic”</li>
</ul>
</li>
</ul>
<p>*scripts are provided for both python and R.</p>
<div class="section level2">
<h2 id="function-documentation">Function Documentation<a class="anchor" aria-label="anchor" href="#function-documentation"></a>
</h2>
<p><strong>Step 0:</strong> Enter into developer mode by running <code><a href="https://devtools.r-lib.org/" class="external-link">library(devtools)</a></code> and then <code>devtools::load_all()</code> to make your functions available for developing.</p>
<p><strong>Step 1:</strong> Click to anywhere inside your function.</p>
<p><img src="reference/figures/funct_doc1.png"></p>
<p><strong>Step 2:</strong> Go to Code -&gt; Insert Roxygen Skeleton. This will populate your script with some template roxygen comments.</p>
<p><img src="reference/figures/funct_doc2.png"></p>
<p><strong>Step 3:</strong> Fill out the template roxygen comments. You can learn more about what to write in these comments <a href="https://r-pkgs.org/man.html" class="external-link">here</a>. Or you can view the <a href="https://github.com/Malone-Disturbance-Ecology-Lab/CarbonExchangeParameters/tree/main/R" class="external-link">function documentation in CarbonExchangeParameters</a> as an example. Do not put anything under “@export”.</p>
<p><img src="reference/figures/funct_doc3.png"></p>
<p>Notes: If you have sample data that you would like to use in your function examples, you can put them under <code>inst/extdata/</code>. Then you can reference your sample data with something like <code>system.file("extdata", "your-file.nc", package = "ERA5Flux")</code>. For functions that export a file, you will need to make sure to have a function argument that lets the user specify where they would like to export the file output. Then in the function example, you can just make the example export to a temporary folder with <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>. This is because CRAN does not allow functions that export something without letting the user decide where it goes. See <code><a href="reference/netcdf_to_csv.html">netcdf_to_csv()</a></code> for an example.</p>
<p><strong>Step 4:</strong> Make sure your updated function script is under the “R” folder. Now render the documentation into an actual help page for the function using <code>devtools::document()</code>. This will generate a .Rd file inside the “man” folder. This becomes your function’s help page and you can now access it by typing <code>?your-function-name</code>.</p>
<p><strong>Step 5:</strong> Always remember to push your commits to GitHub!</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of ERA5Flux from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"Malone-Disturbance-Ecology-Lab/ERA5Flux"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Malone-Disturbance-Ecology-Lab/ERA5Flux/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/Malone-Disturbance-Ecology-Lab/ERA5Flux/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ERA5Flux</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Angel Chen <br><small class="roles"> Author, maintainer </small>   </li>
<li>Sam Jurado <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0005-1902-4066" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>David E Reed <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-8892-1423" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Ammara Talib <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-3259-0220" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Junna Wang <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-3885-846X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Boya Zhang <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-6860-2054" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Sparkle L Malone <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-9034-1076" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Angel Chen, Sam Jurado, David E Reed, Ammara Talib, Junna Wang, Boya Zhang, Sparkle L Malone.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
